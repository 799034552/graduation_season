<!DOCTYPE html>
<html>
<head>
        <title>test</title>
        <body></body>
        <script src = "../js/qrcode.min.js"></script>
        <script src = "../js/jquery-3.3.1.min.js"></script>
</head>
<body>
    <img id = "bg" src = "../img/bg11.jpg">
    <img id = "avatar">
    <div id="qrcode"></div>
    <div id = "test"></div>

</body>
<script>
//         var qrcode = new QRCode(document.getElementById("qrcode"), {
//         width : 500,
//         height : 500
//     });
//     qrcode.makeCode("https://graduation2019.100steps.net/public/html/bubble?userid=");
//     drawAndShareImage();
// function drawAndShareImage() {
//         var wid1 = 390 * 0.4;
//         var hei1 = 568 * 0.65;
//         var canvas = document.createElement("canvas"); 
//         canvas.width = 390;
//         canvas.height = 568;
//         var context = canvas.getContext("2d");
 
//         context.rect(0, 0, canvas.width, canvas.height);
//         context.fillStyle = "#fff";
//         context.fill();
 
//         //底图
//         var myImage = document.getElementById("bg");
//         //myImage.src = "./bg11.jpg";    //背景图片  你自己本地的图片或者在线图片
//         //myImage.setAttribute("crossOrigin",'Anonymous');
//         myImage.crossOrigin = "anonymous";
 
//         myImage.onload = function () {
//             context.drawImage(myImage, 0, 0, 390, 568);

//             myImage2 = $('#qrcode').find('img')[0];
//             //myImage2.setAttribute("crossOrigin",'Anonymous');
//             myImage2.crossOrigin = "anonymous";
//             myImage2.onload =  function () {
//                 console.log("ij");
//                 console.log(myImage,myImage2);
//                 context.drawImage(myImage2, wid1, hei1, 100, 100);
//                 document.getElementById("test").appendChild(canvas);
//                 var base64 = canvas.toDataURL("image/jpg");  //"image/png" 这里注意一下
//                 var img = document.getElementById('avatar');
//                  document.getElementById('avatar').src = base64;
//                 img.setAttribute('src', base64);
//             }
//         }
//     }
(function(){
    let qrcodeEl = document.getElementById('qrcode')
let qrcode = new QRCode(qrcodeEl, {
  text: 'https://avatars1.githubusercontent.com/u/23273077',
  width: 200,
  height: 200,
  colorDark: '#000000',
  colorLight: '#ffffff',
  correctLevel: QRCode.CorrectLevel.H
})
let qrcodeImg = document.querySelector('.qrcode canvas+img')
listenQrcodeSrc()
function listenQrcodeSrc() {
  var observeConfig = { attributes: true }
  var observeCb = function(mutationsList, observer) {
    mutationsList.forEach(function(mutation) {
      if (
        mutation.type.toLowerCase() === 'attributes' &&
        mutation.attributeName.toLowerCase() === 'src'
      ) {
        console.log('qrcodeImg src done!', mutation.target.src)
        observer.disconnect()
      }
    })
  }
  if (typeof MutationObserver !== 'undefined') {
    var observer = new MutationObserver(observeCb)
    observer.observe(qrcodeImg, observeConfig)
  }
}

})();

</script>
</html>